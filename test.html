<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circle of Fifths - Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Circle of Fifths - Application Test</h1>
    
    <div class="test-section info">
        <h2>Test Instructions</h2>
        <p>This page tests the core functionality of the Circle of Fifths application.</p>
        <p>Click the buttons below to run various tests.</p>
    </div>

    <div class="test-section">
        <h2>Core Component Tests</h2>
        <button onclick="testMusicTheory()">Test Music Theory</button>
        <button onclick="testAudioEngine()">Test Audio Engine</button>
        <button onclick="testCircleRenderer()">Test Circle Renderer</button>
        <button onclick="runAllTests()">Run All Tests</button>
    </div>

    <div id="results"></div>

    <!-- Include the application scripts -->
    <script src="js/musicTheory.js"></script>
    <script src="js/audioEngine.js"></script>
    <script>
        // Simple test framework
        function addResult(test, success, message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${success ? 'success' : 'error'}`;
            div.innerHTML = `<h3>${test}</h3><p>${message}</p>`;
            results.appendChild(div);
        }

        function testMusicTheory() {
            try {
                const theory = new MusicTheory();
                
                // Test basic functionality
                const scaleNotes = theory.getScaleNotes('C', 'major');
                const expectedNotes = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
                const scaleMatch = JSON.stringify(scaleNotes) === JSON.stringify(expectedNotes);
                
                // Test key signature
                const keySignature = theory.getKeySignature('G', 'major');
                const signatureCorrect = keySignature.sharps === 1 && keySignature.flats === 0;
                
                // Test related keys
                const relatedKeys = theory.getRelatedKeys('C', 'major');
                const relatedCorrect = relatedKeys.dominant.key === 'G' && 
                                     relatedKeys.subdominant.key === 'F' && 
                                     relatedKeys.relative.key === 'A';
                
                if (scaleMatch && signatureCorrect && relatedCorrect) {
                    addResult('Music Theory', true, 'All music theory tests passed successfully!');
                } else {
                    addResult('Music Theory', false, 'Some music theory tests failed.');
                }
            } catch (error) {
                addResult('Music Theory', false, `Error: ${error.message}`);
            }
        }

        function testAudioEngine() {
            try {
                const audio = new AudioEngine();
                const state = audio.getState();
                
                if (state.settings && state.settings.masterVolume !== undefined) {
                    addResult('Audio Engine', true, 'Audio engine created successfully. Audio will initialize on first use.');
                } else {
                    addResult('Audio Engine', false, 'Audio engine state is invalid.');
                }
            } catch (error) {
                addResult('Audio Engine', false, `Error: ${error.message}`);
            }
        }

        function testCircleRenderer() {
            try {
                // Create a temporary SVG element
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('viewBox', '0 0 800 800');
                
                // Add required elements
                const keySegments = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                keySegments.id = 'key-segments';
                svg.appendChild(keySegments);
                
                const centerContent = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                centerContent.id = 'center-content';
                svg.appendChild(centerContent);
                
                // Add text elements
                const centerKey = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                centerKey.className = 'center-key';
                centerContent.appendChild(centerKey);
                
                const centerMode = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                centerMode.className = 'center-mode';
                centerContent.appendChild(centerMode);
                
                const centerSignature = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                centerSignature.className = 'center-signature';
                centerContent.appendChild(centerSignature);
                
                document.body.appendChild(svg);
                
                const theory = new MusicTheory();
                const renderer = new CircleRenderer(svg, theory);
                const state = renderer.getState();
                
                document.body.removeChild(svg);
                
                if (state.selectedKey && state.currentMode) {
                    addResult('Circle Renderer', true, `Circle renderer initialized with key: ${state.selectedKey} ${state.currentMode}`);
                } else {
                    addResult('Circle Renderer', false, 'Circle renderer state is invalid.');
                }
            } catch (error) {
                addResult('Circle Renderer', false, `Error: ${error.message}`);
            }
        }

        function runAllTests() {
            document.getElementById('results').innerHTML = '';
            testMusicTheory();
            testAudioEngine();
            testCircleRenderer();
            
            addResult('Test Suite', true, 'All component tests completed. Check individual results above.');
        }

        // Run basic tests on page load
        window.addEventListener('load', () => {
            addResult('Page Load', true, 'Test page loaded successfully. Scripts are available.');
        });
    </script>
</body>
</html>
