<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Theme Test - Circle of Fifths</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .test-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 15px;
            z-index: 1001;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
        }
        .test-controls h3 {
            margin: 0 0 10px 0;
            color: var(--primary-color);
            font-size: 14px;
        }
        .test-controls button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 12px;
        }
        .test-controls button:hover {
            opacity: 0.9;
        }
        .test-status {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 10px;
            font-family: monospace;
        }
        .quick-theme-switch {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }
        .quick-theme-switch button {
            flex: 1;
            padding: 5px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <!-- Test Controls Panel -->
    <div class="test-controls">
        <h3>üé® Theme Testing</h3>
        <div class="quick-theme-switch">
            <button onclick="quickTheme('light')">‚òÄÔ∏è</button>
            <button onclick="quickTheme('dark')">üåô</button>
            <button onclick="quickTheme('system')">üíª</button>
        </div>
        <button onclick="runThemeTest()">Run Full Test</button>
        <button onclick="cycleThemes()">Cycle Themes</button>
        <button onclick="toggleConsole()">Toggle Console</button>
        <div class="test-status" id="test-status">Ready</div>
    </div>

    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header class="header" role="banner">
        <div class="container">
            <h1 class="title">
                <span class="title-main">Circle of Fifths</span>
                <span class="title-sub">Interactive Music Theory - Theme Testing</span>
            </h1>

            <!-- Mode Toggle -->
            <div class="mode-toggle" role="group" aria-label="Circle mode selection">
                <button id="major-mode" class="mode-btn active" aria-pressed="true" data-mode="major">
                    Major
                </button>
                <button id="minor-mode" class="mode-btn" aria-pressed="false" data-mode="minor">
                    Minor
                </button>
            </div>

            <!-- Difficulty Level Toggle -->
            <div class="difficulty-toggle" role="group" aria-label="Difficulty level selection">
                <button id="beginner-level" class="difficulty-btn active" aria-pressed="true" data-level="beginner">
                    Beginner
                </button>
                <button id="advanced-level" class="difficulty-btn" aria-pressed="false" data-level="advanced">
                    Advanced
                </button>
            </div>

            <!-- Theme Toggle -->
            <div class="theme-toggle" role="group" aria-label="Theme selection">
                <button id="theme-toggle-btn" class="theme-btn" aria-label="Change theme" aria-haspopup="true" aria-expanded="false">
                    <span class="theme-icon">üíª</span>
                    <span class="theme-text">System</span>
                    <span class="theme-arrow">‚ñº</span>
                </button>
                <div id="theme-dropdown" class="theme-dropdown" role="menu" aria-hidden="true">
                    <button class="theme-option" role="menuitem" data-theme="light">
                        <span class="theme-option-icon">‚òÄÔ∏è</span>
                        <span class="theme-option-text">Light</span>
                    </button>
                    <button class="theme-option" role="menuitem" data-theme="dark">
                        <span class="theme-option-icon">üåô</span>
                        <span class="theme-option-text">Dark</span>
                    </button>
                    <button class="theme-option active" role="menuitem" data-theme="system">
                        <span class="theme-option-icon">üíª</span>
                        <span class="theme-option-text">System</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="main" role="main">
        <div class="container">
            <!-- Circle Container -->
            <div class="circle-container" role="application" aria-label="Interactive Circle of Fifths">
                <svg id="circle-svg" class="circle-svg" viewBox="0 0 800 800" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="circle-title circle-desc">
                    <title id="circle-title">Circle of Fifths Diagram</title>
                    <desc id="circle-desc">Interactive circular diagram showing the 12 musical keys and their relationships</desc>

                    <!-- Background circle -->
                    <circle cx="400" cy="400" r="350" class="background-circle" />

                    <!-- Key segments will be dynamically generated -->
                    <g id="key-segments" class="key-segments"></g>

                    <!-- Center circle for key information -->
                    <circle cx="400" cy="400" r="120" class="center-circle" />
                    <g id="center-content" class="center-content">
                        <text x="400" y="380" class="center-key" text-anchor="middle">C</text>
                        <text x="400" y="410" class="center-mode" text-anchor="middle">Major</text>
                        <text x="400" y="430" class="center-signature" text-anchor="middle">No sharps or flats</text>
                    </g>
                </svg>

                <!-- Audio Controls -->
                <div class="audio-controls" role="group" aria-label="Audio playback controls">
                    <button id="play-scale" class="audio-btn" aria-label="Play scale">
                        <span class="btn-icon">‚ô™</span>
                        Scale
                    </button>
                    <button id="play-chord" class="audio-btn" aria-label="Play chord">
                        <span class="btn-icon">‚ô´</span>
                        Chord
                    </button>
                    <button id="play-progression" class="audio-btn" aria-label="Play chord progression">
                        <span class="btn-icon">‚ô¨</span>
                        Progression
                    </button>
                    <button id="stop-audio" class="audio-btn stop-btn" aria-label="Stop audio">
                        <span class="btn-icon">‚èπ</span>
                        Stop
                    </button>
                </div>
            </div>

            <!-- Information Panel -->
            <aside class="info-panel" role="complementary" aria-label="Key information">
                <div class="info-content">
                    <h2 id="info-title" class="info-title">C Major</h2>

                    <div class="info-section">
                        <h3 class="info-subtitle">Key Signature</h3>
                        <p id="key-signature" class="info-text">No sharps or flats</p>
                    </div>

                    <div class="info-section">
                        <h3 class="info-subtitle">Scale Notes</h3>
                        <p id="scale-notes" class="info-text">C - D - E - F - G - A - B</p>
                    </div>

                    <div class="info-section">
                        <h3 class="info-subtitle">Related Keys</h3>
                        <div id="related-keys" class="related-keys">
                            <span class="related-key" data-relationship="dominant">Dominant: G</span>
                            <span class="related-key" data-relationship="subdominant">Subdominant: F</span>
                            <span class="related-key" data-relationship="relative">Relative: A minor</span>
                        </div>
                    </div>

                    <div class="info-section advanced-only">
                        <h3 class="info-subtitle">Common Chord Progressions</h3>
                        <div id="chord-progressions" class="chord-progressions">
                            <button class="progression-btn" data-progression="I-V-vi-IV">I - V - vi - IV</button>
                            <button class="progression-btn" data-progression="ii-V-I">ii - V - I</button>
                            <button class="progression-btn" data-progression="vi-IV-I-V">vi - IV - I - V</button>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <p class="footer-text">Interactive Circle of Fifths - Learn music theory through exploration</p>
            <p class="footer-credits">Built with Web Audio API and modern web technologies</p>
        </div>
    </footer>

    <!-- Loading indicator -->
    <div id="loading" class="loading" aria-hidden="true">
        <div class="loading-spinner"></div>
        <p class="loading-text">Loading audio system...</p>
    </div>

    <!-- Scripts -->
    <script src="js/themeManager.js"></script>
    <script src="js/themeToggle.js"></script>
    <script src="js/musicTheory.js"></script>
    <script src="js/audioEngine.js"></script>
    <script src="js/circleRenderer.js"></script>
    <script src="js/interactions.js"></script>
    <script src="js/app.js"></script>
    <script src="tests/visual/theme-verification.js"></script>
    
    <script>
        let themeManager;
        let circleRenderer;
        let musicTheory;
        let isConsoleVisible = false;
        let cycleInterval;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize theme manager
            themeManager = new ThemeManager();

            // Initialize music theory
            if (typeof MusicTheory !== 'undefined') {
                musicTheory = new MusicTheory();
            }

            // Initialize circle renderer
            const svg = document.getElementById('circle-svg');
            if (svg && musicTheory && typeof CircleRenderer !== 'undefined') {
                circleRenderer = new CircleRenderer(svg, musicTheory);
                // Ensure the circle is rendered
                circleRenderer.init();
                updateStatus('Application initialized with circle renderer');
            } else {
                updateStatus('Application initialized (some components missing)');
                console.warn('Missing components:', {
                    svg: !!svg,
                    musicTheory: !!musicTheory,
                    CircleRenderer: typeof CircleRenderer !== 'undefined'
                });
            }
        });

        function quickTheme(theme) {
            if (themeManager) {
                themeManager.setTheme(theme);
                updateStatus(`Switched to ${theme} theme`);
            }
        }

        function runThemeTest() {
            updateStatus('Running theme verification test...');
            const test = new ThemeVerificationTest();
            test.runAllTests().then(() => {
                updateStatus('Theme test completed - check console');
            });
        }

        function cycleThemes() {
            if (cycleInterval) {
                clearInterval(cycleInterval);
                cycleInterval = null;
                updateStatus('Theme cycling stopped');
                return;
            }

            const themes = ['light', 'dark', 'system'];
            let currentIndex = 0;
            
            updateStatus('Cycling themes every 2 seconds...');
            cycleInterval = setInterval(() => {
                quickTheme(themes[currentIndex]);
                currentIndex = (currentIndex + 1) % themes.length;
            }, 2000);
        }

        function toggleConsole() {
            // This is a placeholder - in a real browser, you'd need to use dev tools
            isConsoleVisible = !isConsoleVisible;
            updateStatus(isConsoleVisible ? 'Console should be open' : 'Console can be closed');
            if (isConsoleVisible) {
                console.log('üé® Theme Testing Console - Use runThemeTest() to test themes');
            }
        }

        function updateStatus(message) {
            const status = document.getElementById('test-status');
            if (status) {
                status.textContent = message;
            }
        }

        // Make functions available globally for testing
        window.quickTheme = quickTheme;
        window.runThemeTest = runThemeTest;
        window.cycleThemes = cycleThemes;
        window.toggleConsole = toggleConsole;
    </script>
</body>
</html>
